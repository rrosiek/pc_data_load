from data_load.base.utils.export_doc_ids import export_doc_ids
from data_load.base.data_source_csv import CSVDataSource


SERVER = 'http://localhost:9200'
INDEX = 'irdb_v4'
TYPE = 'grant'


docs_to_find = ['9216991',
'9271505',
'9378090',
'9378487',
'9378789',
'9379450',
'9385391',
'9386057',
'9387358',
'9388954',
'9388959',
'9390026',
'9390429',
'9391176',
'9392131',
'9392513',
'9392527',
'9392883',
'9392885',
'9397519',
'9399609',
'9399617',
'9404871',
'9404963',
'9406100',
'9406467',
'9407011',
'9407763',
'9407768',
'9410483',
'9411708',
'9411718',
'9412103',
'9412115',
'9412117',
'9412125',
'9412414',
'9412415',
'9412426',
'9412811',
'9413306',
'9413309',
'9414573',
'9414576',
'9414989',
'9415414',
'9415457',
'9416071',
'9416903',
'9416914',
'9420523',
'9421543',
'9424272',
'9425212',
'9427971',
'9428411',
'9431041',
'9431467',
'9431554',
'9431589',
'9436228',
'9436234',
'9438474',
'9439647',
'9440332',
'9440975',
'9440980',
'9443504',
'9443579',
'9444335',
'9444403',
'9444994',
'9445278',
'9445310',
'9445390',
'9448678',
'9452876',
'9452879',
'9453264',
'9453568',
'9453644',
'9454695',
'9454821',
'9454824',
'9455196',
'9455592',
'9455593',
'9455594',
'9455597',
'9455993',
'9455994',
'9459308',
'9459851',
'9461472',
'9461474',
'9461476',
'9462043',
'9462566',
'9462828',
'9463650',
'9464513',
'9464815',
'9464816',
'9465349',
'9466318',
'9467426',
'9467428',
'9467429',
'9467430',
'9467431',
'9467974',
'9468128',
'9469257',
'9469664',
'9470663',
'9471320',
'9471339',
'9471363',
'9471616',
'9471767',
'9471774',
'9472205',
'9472281',
'9472296',
'9472557',
'9473571',
'9474050',
'9474099',
'9474101',
'9474585',
'9476919',
'9478083',
'9478105',
'9481249',
'9481253',
'9481807',
'9484225',
'9484242',
'9484254',
'9485265',
'9485315',
'9485883',
'9485885',
'9485905',
'9486898',
'9487098',
'9488411',
'9491680',
'9493387',
'9493388',
'9493389',
'9493390',
'9493391',
'9493392',
'9493941',
'9494498',
'9494499',
'9494500',
'9495656',
'9496248',
'9496650',
'9502230',
'9502233',
'9503687',
'9504038',
'9506338',
'9506656',
'9507136',
'9508757',
'9509335',
'9509757',
'9511007',
'9511110',
'9511144',
'9511737',
'9511746',
'9511747',
'9511756',
'9512662',
'9513849',
'9513992',
'9514810',
'9514823',
'9516882',
'9517655',
'9517680',
'9517681',
'9517682',
'9517683',
'9517684',
'9517685',
'9517686',
'9517687',
'9517711',
'9522164',
'9523237',
'9525904',
'9527722',
'9527915',
'9528901',
'9529505',
'9529862',
'9533968',
'9533985',
'9534507',
'9534792',
'9535026',
'9535824',
'9535826',
'9537036',
'9537220',
'9537223',
'9537767',
'9538571',
'9539705',
'9539815',
'9540785',
'9541628',
'9541629',
'9542160',
'9542166',
'9542194',
'9542195',
'9542196',
'9542197',
'9542198',
'9542694',
'9542695',
'9542699',
'9542700',
'9543167',
'9543728',
'9543766',
'9543949',
'9544840',
'9545648',
'9546181',
'9546473',
'9546487',
'9547247',
'9547756',
'9548868',
'9557134',
'9561463',
'9561531',
'9569590',
'9570787',
'9570789',
'9570790',
'9570792',
'9571939',
'9573700',
'9576583',
'9580094',
'9581499',
'9582828',
'9583069',
'9586083',
'9588654',
'9589007',
'9589152',
'9591094',
'9591096',
'9591101',
'9591102',
'9591113',
'9591115',
'9591829',
'9598227',
'9598506',
'9598639',
'9601439',
'9606871',
'9613629',
'9615129',
'9616105',
'9616544',
'9621312',
'9621738',
'9624713',
'9624714',
'9625591',
'9631943',
'9631944',
'9631945',
'9631952',
'9631987',
'9634726',
'9638023',
'9652782',
'9661510',
'9662639',
'9670918',
'9672239',
'9677877',
'9687290',
'9687411',
'9692972',
'9693014',
'9726225',
'9739895',
'9744280',
'9752704',
'9754283',
'9754305',
'9755067',
'9786282',
'9786307',
'9786338',
'9786366',
'9786375',
'9786401',
'9786408',
'9786415',
'9786416',
'9786447',
'9786507',
'9786526',
'9786527',
'9787768',
'9789622',
'9789623']

def run():
    doc_ids = export_doc_ids(server=SERVER, src_index=INDEX, src_type=TYPE)
    
    # doc_ids = doc_ids.keys()
    # doc_ids.sort()

    docs_missing = []
    for _id in docs_to_find:
        id_to_find = 'IRDB' + _id
        if id_to_find not in doc_ids:
            docs_missing.append(_id)

    print 'total docs', len(doc_ids)
    print 'docs to find', len(docs_to_find)
    print 'missing docs', len(docs_missing)

    # print len(doc_ids)
    # print doc_ids[-4]
    # print doc_ids[-3]
    # print doc_ids[-2]
    # print doc_ids[-1]

irdb_ids = {}


def process_data():

    appls_at = '/data/data_loading/old-records/irdb_2018_06/source_files/h/APPLS_AT.csv'
    appls_mv = '/data/data_loading/old-records/irdb_2018_06/source_files/h/APPLS_MV.csv'

    print 'processing', appls_at
    csv_data_source = CSVDataSource(appls_at)
    csv_data_source.process_rows(process_row)

    print 'processing', appls_mv
    csv_data_source1 = CSVDataSource(appls_mv)
    csv_data_source1.process_rows(process_row)

    print len(irdb_ids), 'total ids'
    sorted_ids = irdb_ids.keys()
    sorted_ids.sort()

    print sorted_ids[-3]
    print sorted_ids[-2]
    print sorted_ids[-1]

    id_to_search = '9726225'
    if id_to_search in irdb_ids:
        print id_to_search, irdb_ids[id_to_search]
    else:
        print id_to_search, 'not found'

    id_to_search = '9554780'
    if id_to_search in irdb_ids:
        print id_to_search, irdb_ids[id_to_search]
    else:
        print id_to_search, 'not found'


def process_row(row, current_index):
    appl_id = None
    if 'APPL_ID' in row:
        appl_id = str(row['APPL_ID'])

    grant_num = ""
    if 'GRANT_NUM' in row:
        grant_num = row['GRANT_NUM']

    if appl_id is not None:
        if appl_id not in irdb_ids:
            irdb_ids[appl_id] = []

        irdb_ids[appl_id].append(grant_num)

    if current_index % 1000 == 0:
        print 'Processed', current_index, 'ids', appl_id

    return True

# process_data()


run()